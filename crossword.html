<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labyrinth Hotel - Final Cipher (Fix v2)</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+KR:wght@400;700&family=Space+Mono&display=swap" rel="stylesheet">
    <script>
    // 1. 마우스 우클릭 및 단축키 차단 (기존 유지)
    document.addEventListener('contextmenu', e => e.preventDefault(), false);
    document.addEventListener('keydown', e => {
        if (e.key === "F12" || (e.ctrlKey && ['u', 's', 'i', 'j'].includes(e.key.toLowerCase()))) {
            e.preventDefault();
        }
    }, false);
    </script>
    <style>
        :root {
            --bg-main: #1a1a1b;
            --silver-dark: #7a7a7a;
            --silver-mid: #b0b0b0;
            --silver-bright: #e0e0e0;
            --cell-active: #2d2d2e;
            --metal-border: #4a4a4b;
            --correct-bg: #d1d1d1;
            --correct-text: #0a0a0a;
            --highlight-pink: rgba(255, 182, 193, 0.5);
            --cell-size: 40px;
        }

        /* [커서 설정] 모든 크기의 PC/iframe에서 보이도록 수정 */
        * { cursor: none; }
        .cursor { position: fixed; width: 8px; height: 8px; background: #8B0000; border-radius: 50%; pointer-events: none; z-index: 9999; }
        .cursor-follower { position: fixed; width: 40px; height: 40px; border: 1px solid rgba(139, 0, 0, 0.5); border-radius: 50%; pointer-events: none; transition: transform 0.1s; z-index: 9998; }
        @media (pointer: coarse) {
            .cursor, .cursor-follower { display: none; }
            * { cursor: auto; }
        }

        body {
            background-color: var(--bg-main);
            color: var(--silver-bright);
            font-family: 'Noto Serif KR', serif;
            margin: 0; padding: 20px 10px;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
        }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: clamp(1.5rem, 8vw, 2.5rem);
            letter-spacing: clamp(4px, 3vw, 12px);
            background: linear-gradient(to bottom, var(--silver-bright), var(--silver-dark));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 30px; text-align: center;
        }

        .grid-scroll-area {
            width: 100%; overflow-x: auto;
            display: flex; justify-content: flex-start;
            padding-bottom: 20px; -webkit-overflow-scrolling: touch;
        }

        @media (min-width: 1050px) { .grid-scroll-area { justify-content: center; overflow-x: visible; } }

        .grid-frame {
            display: grid;
            grid-template-columns: repeat(25, var(--cell-size));
            grid-template-rows: repeat(20, var(--cell-size));
            gap: 2px; background-color: var(--metal-border);
            padding: 10px; border: 4px solid var(--silver-dark);
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            flex-shrink: 0;
        }

        .cell {
            width: var(--cell-size); height: var(--cell-size);
            background-color: transparent;
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }

        .cell.active { background-color: var(--cell-active); cursor: pointer; }
        .index {
            position: absolute; top: 1px; left: 2px;
            font-size: 0.7rem; color: var(--silver-mid); font-weight: bold;
            pointer-events: none; /* 클릭 방해 금지 */
        }

        .letter {
            font-family: 'Space Mono', monospace;
            font-size: calc(var(--cell-size) * 0.5); 
            font-weight: bold; pointer-events: none;
            opacity: 0; transition: opacity 0.4s ease;
        }

        .cell.revealed { background: var(--correct-bg) !important; }
        .cell.revealed .letter { opacity: 1; color: var(--correct-text); }
        .cell.special-highlight { background-color: var(--highlight-pink) !important; box-shadow: inset 0 0 8px rgba(255,192,203,0.5); }

        .clues-wrapper {
            margin-top: 30px; display: grid; grid-template-columns: 1fr 1fr;
            gap: 20px; width: 100%; max-width: 950px;
            background: rgba(255,255,255,0.03); padding: 20px; box-sizing: border-box;
        }

        @media (max-width: 768px) {
            :root { --cell-size: 30px; }
            .clues-wrapper { grid-template-columns: 1fr; }
        }

        .clue-group h2 { font-family: 'Cinzel', serif; border-bottom: 2px solid var(--silver-dark); padding-bottom: 8px; font-size: 1.2rem; }
        .clue-item { margin: 10px 0; font-size: 0.9rem; color: #ccc; line-height: 1.4; }

        .control-panel { margin-top: 20px; width: 100%; text-align: center; }
        .hotel-btn {
            background: transparent; color: #8c8883; border: 1px solid #5a5550;
            padding: 12px 20px; font-family: 'Cinzel', serif;
            cursor: pointer; letter-spacing: 1px; transition: all 0.4s ease;
            font-size: 0.75rem; width: 80%; max-width: 300px;
        }
    </style>
</head>
<body>

    <div class="cursor"></div>
    <div class="cursor-follower"></div>

    <h1>Labyrinth Hotel</h1>

    <div class="grid-scroll-area">
        <div class="grid-frame" id="grid"></div>
    </div>

    <div class="control-panel">
        <button onclick="resetGrid()" class="hotel-btn">RESEAL THE PUZZLE (전체 초기화)</button>
    </div>

    <div class="clues-wrapper">
        <div class="clue-group">
            <h2>Across</h2>
            <div class="clue-item">2. </div>
            <div class="clue-item">3. </div>
            <div class="clue-item">4. </div>
            <div class="clue-item">5. </div>
            <div class="clue-item">6. </div>
            <div class="clue-item">7. </div>
        </div>
        <div class="clue-group">
            <h2>Down</h2>
            <div class="clue-item">2. </div>
            <div class="clue-item">3. </div>
            <div class="clue-item">4. </div>
            <div class="clue-item">5. </div>
            <div class="clue-item">6. </div>
            <div class="clue-item">7. </div>
        </div>
    </div>

<script>
    const puzzleWords = [
        { r: 2, c: 0, dir: 'A', id: '2', len: 15 },
        { r: 3, c: 5, dir: 'A', id: '3', len: 9 },
        { r: 5, c: 9, dir: 'A', id: '7', len: 12 },
        { r: 6, c: 9, dir: 'A', id: '6', len: 13 },
        { r: 9, c: 7, dir: 'A', id: '4', len: 12 },
        { r: 10, c: 9, dir: 'A', id: '5', len: 13 },
        { r: 0, c: 0, dir: 'D', id: '4', len: 12 },
        { r: 1, c: 2, dir: 'D', id: '7', len: 13 },
        { r: 1, c: 5, dir: 'D', id: '6', len: 12 },
        { r: 0, c: 10, dir: 'D', id: '5', len: 12 },
        { r: 10, c: 12, dir: 'D', id: '2', len: 10 },
        { r: 10, c: 20, dir: 'D', id: '3', len: 10 }
    ];

    const highlightCoords = ["0-0", "7-2", "10-2", "7-5", "5-9", "3-10", "10-13", "6-17", "10-20"];
    const gridElement = document.getElementById('grid');
    const cellMap = {};

    puzzleWords.forEach(wordData => {
        for (let i = 0; i < wordData.len; i++) {
            const r = wordData.dir === 'A' ? wordData.r : wordData.r + i;
            const c = wordData.dir === 'A' ? wordData.c + i : wordData.c;
            const key = `${r}-${c}`;
            if (!cellMap[key]) cellMap[key] = { indices: [], words: [] };
            if (i === 0) cellMap[key].indices.push(wordData.id);
            cellMap[key].words.push(wordData);
        }
    });

    function drawGrid() {
        gridElement.innerHTML = '';
        for (let r = 0; r < 20; r++) {
            for (let c = 0; c < 25; c++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                const key = `${r}-${c}`;
                const data = cellMap[key];

                if (highlightCoords.includes(key)) cell.classList.add('special-highlight');

                if (data) {
                    cell.classList.add('active');
                    cell.id = `cell-${r}-${c}`;
                    if (data.indices.length > 0) {
                        const idx = document.createElement('span');
                        idx.className = 'index';
                        idx.textContent = data.indices[0];
                        cell.appendChild(idx);
                    }
                    const letter = document.createElement('span');
                    letter.className = 'letter';
                    cell.appendChild(letter);

                    cell.onclick = () => {
                        const currentText = cell.querySelector('.letter').textContent;
                        
                        // [수정된 핵심 로직] 
                        // 1. 숫자가 있는 칸인지 확인
                        const cellIndex = data.indices.length > 0 ? data.indices[0] : null;
                        let defaultTarget;

                        if (cellIndex) {
                            // 2. 숫자가 있다면 해당 ID를 가진 단어를 우선순위로 설정 (예: 2번 칸 클릭 시 Down 2번 우선)
                            defaultTarget = data.words.find(w => w.id === cellIndex);
                        }
                        
                        // 3. 숫자가 없는 칸이거나 매칭 실패 시 첫 번째 단어 선택
                        if (!defaultTarget) defaultTarget = data.words[0];

                        const msg = `[${defaultTarget.dir === 'A' ? '가로' : '세로'} ${defaultTarget.id}번] 단어를 입력하세요 (길이: ${defaultTarget.len}):` +
                                    (currentText ? `\n(현재 칸 글자: "${currentText}")` : "");

                        const input = prompt(msg);
                        if (input === null) return;
                        
                        const upperInput = input.trim().toUpperCase();
                        if (upperInput === "") {
                            clearWord(defaultTarget);
                            return;
                        }

                        // 4. 입력한 길이에 맞는 단어 영역을 찾아 채움 (가로 5번과 겹치는 지점 해결)
                        const matchedWord = data.words.find(w => w.len === upperInput.length);
                        if (matchedWord) {
                            fillWord(matchedWord, upperInput);
                        } else {
                            alert(`길이가 맞지 않습니다. (입력: ${upperInput.length}자, 필요한 길이: ${defaultTarget.len}자)`);
                        }
                    };
                }
                gridElement.appendChild(cell);
            }
        }
    }

    function fillWord(w, text) {
        for (let i = 0; i < w.len; i++) {
            const r = w.dir === 'A' ? w.r : w.r + i;
            const c = w.dir === 'A' ? w.c + i : w.c;
            const target = document.getElementById(`cell-${r}-${c}`);
            if (target) {
                target.classList.add('revealed');
                target.querySelector('.letter').textContent = text[i];
            }
        }
    }

    function clearWord(w) {
        for (let i = 0; i < w.len; i++) {
            const r = w.dir === 'A' ? w.r : w.r + i;
            const c = w.dir === 'A' ? w.c + i : w.c;
            const target = document.getElementById(`cell-${r}-${c}`);
            if (target) {
                target.classList.remove('revealed');
                target.querySelector('.letter').textContent = '';
            }
        }
    }

    function resetGrid() {
        if (confirm("입력한 글자들을 모두 초기화하겠습니까?")) {
            document.querySelectorAll('.cell.revealed').forEach(cell => {
                cell.classList.remove('revealed');
                cell.querySelector('.letter').textContent = '';
            });
        }
    }

    // [커서 이동 로직]
    const cursor = document.querySelector('.cursor');
    const follower = document.querySelector('.cursor-follower');
    document.addEventListener('mousemove', e => {
        cursor.style.left = e.clientX + 'px';
        cursor.style.top = e.clientY + 'px';
        setTimeout(() => {
            follower.style.left = e.clientX - 20 + 'px';
            follower.style.top = e.clientY - 20 + 'px';
        }, 50);
    });

    drawGrid();
</script>
</body>
</html>
